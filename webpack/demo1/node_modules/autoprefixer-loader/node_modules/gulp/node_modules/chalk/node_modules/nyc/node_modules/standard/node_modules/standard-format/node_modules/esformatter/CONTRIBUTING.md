# Project Structure / Contributing


Check open issues for a list of features/bugs that we would like to see
fixed/implemented.


## EditorConfig

To make sure we all use the same basic settings (indent, EOL, EOF) please
install [EditorConfig](http://editorconfig.org/#download). It will make code
review/merge easier.


## New Features / Bugs

The easiest way to add new features and fix bugs is to create a test file with
mixed input and use the [rocambole-visualize](http://piuccio.github.io/rocambole-visualize/)
or the [esprima parser demo](http://esprima.org/demo/parse.html) to visualize
the syntax tree and implement each step separately.

A good example of a commit that fixes a bug:
https://github.com/millermedeiros/esformatter/commit/ebafa00f76 and a good
example of a commit that introduces a new feature:
https://github.com/millermedeiros/esformatter/commit/e7d82cc81e



## How it works?

We augment the AST with
[rocambole](https://github.com/millermedeiros/rocambole), so every `node` have
[extra
properties](https://github.com/millermedeiros/rocambole#extra-properties) that
can be used to traverse the AST (similar to the DOM).

The whole process is very similar to working with the DOM. Don't feel
intimidated by *complex names* like `ConditionalExpressionConsequent`, use the
[esprima parser demo](http://esprima.org/demo/parse.html) and/or
[rocambole-visualize](http://piuccio.github.io/rocambole-visualize/) as reference
and you should be good to go.

We rely on some external libraries to add/remove/find tokens:

 - [rocambole-token](https://github.com/millermedeiros/rocambole-token)
 - [rocambole-whitespace](https://github.com/millermedeiros/rocambole-whitespace)
 - [rocambole-linebreak](https://github.com/millermedeiros/rocambole-linebreak)
 - [rocambole-indent](https://github.com/millermedeiros/rocambole-indent)

### Recursion

The recursion starts from the *leaf nodes* and moves till it reaches the
`Program` root. It works this way because child nodes usually affects the
parent nodes structure (specially line breaks), that gives the option for the
parent node to override the child node behavior if needed.

### Adding/Removing line breaks and white spaces

The `format` method of each object exposed on `lib/hooks.js` is called once for
each matching `node`. The `format` method is responsible for adding/removing
line breaks and white spaces based on the node structure and config options.

### Indentation

We do the indentation after the whole process; that is necessary since the
parent nodes affects the indentation of the child nodes (line breaks might be
added or removed during the process).

Indentation starts from root node and moves up the tree until it reaches the
leaf nodes (this allow child nodes to decrement the indent added by parent
nodes and is more intuitive).

The core logic is handled by `lib/indent.js` and
[rocambole-indent](https://github.com/millermedeiros/rocambole-indent), but
most nodes actually require specific rules to detect the *indent edges*, so
most `lib/hooks` also implement a method `getIn