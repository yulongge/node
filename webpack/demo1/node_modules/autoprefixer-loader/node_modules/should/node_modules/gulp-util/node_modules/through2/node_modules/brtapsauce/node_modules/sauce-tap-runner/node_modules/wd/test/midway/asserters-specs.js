require('../helpers/setup');

describe('asserters ' + env.ENV_DESC, function() {
  var asserters = wd.asserters;
  var page = '<div id="theDiv"></div>';

  var appendChild =
    'setTimeout(function() {\n' +
    ' $("#theDiv").append("<div class=\\"child\\">a waitFor child</div>");\n' +
    '}, arguments[0]);\n';

  var appendChildAndHide =
    '$("#theDiv").append("<div class=\\"child\\">a waitFor child</div>");\n' +
    'setTimeout(function() {\n' +
    ' $("#theDiv .child").hide();\n' +
    '}, arguments[0]);\n';

  var appendChildHideAndShow =
    '$("#theDiv").append("<div class=\\"child\\">a waitFor child</div>");\n' +
    '$("#theDiv .child").hide();\n' +
    'setTimeout(function() {\n' +
    ' $("#theDiv .child").show();\n' +
    '}, arguments[0]);\n';

  var appendChildHideAndShowParentDiv =
    '$("#theDiv").append("<div class=\\"child\\">a waitFor child</div>");\n' +
    '$("#theDiv").hide();\n' +
    'setTimeout(function() {\n' +
    ' $("#theDiv").show();\n' +
    '}, arguments[0]);\n';

  var appendChildAndHideParentDiv =
    '$("#theDiv").append("<div class=\\"child\\">a waitFor child</div>");\n' +
    'setTimeout(function() {\n' +
    ' $("#theDiv").hide();\n' +
    '}, arguments[0]);\n';

  var partials = {};

  var browser;
  require('./midway-base')(this, partials).then(function(_browser) { browser = _browser; });

  partials['asserters.nonEmptyText'] = page;
  it('asserters.nonEmptyText', function() {
    return browser
      .execute( appendChild, [env.BASE_TIME_UNIT] )
      .elementByCss("#theDiv .child").should.be.rejectedWith(/status: 7/)
      .waitForElementByCss("#theDiv .child", asserters.nonEmptyText ,2 * env.BASE_TIME_UNIT)
      .text().should.become('a waitFor child');
  });

  partials['asserters.textInclude'] = page;
  it('asserters.textInclude', function() {
    return browser
      .execute( appendChild, [env.BASE_TIME_UNIT] )
      .elementByCss("#theDiv .child").should.be.rejectedWith(/status: 7/)
      .waitForElementByCss("#theDiv .child", asserters.textInclude('a waitFor child') ,2 * env.BASE_TIME_UNIT)
      .text().should.become('a waitFor child');
  });

  partials['asserters.isDisplayed'] = page;
  it('asserters.isDisplayed', function() {
    return browser
      .execute( appendChildHideAndShow, [env.BASE_TIME_UNIT] )
      .waitForElementByCss("#theDiv .child", asserters.isDisplayed ,2 * env.BASE_TIME_UNIT)
      .waitForElementByCss("#theDiv .child", asserters.isVisible ,2 * env.BASE_TIME_UNIT) // deprecated
      .text().should.become('a waitFor child');
  });

  partials['asserters.isDisplayed (hide and show parent)'] = page;
  it('asserters.isDisplayed (hide and show parent)', function() {
    return browser
      .execute( appendChildHideAndShowParentDiv, [env.BASE_TIME_UNIT] )
      .waitForElementByCss("#theDiv .child", asserters.isDisplayed ,2 * env.BASE_TIME_UNIT)
      .text().should.become('a waitFor child');
  });

  partials['asserters.isNotDisplayed'] = page;
  it('asserters.isNotDisplayed', function() {
    return browser
      .execute( appendChildAndHid