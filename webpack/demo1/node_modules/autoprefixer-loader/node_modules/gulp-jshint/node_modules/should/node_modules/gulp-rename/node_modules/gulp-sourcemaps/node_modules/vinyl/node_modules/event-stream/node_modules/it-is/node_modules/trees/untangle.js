//untangle2.js

//just thought of a much more space-efficent way.

var traverse = require('traverser')
  , assert = require('assert')

exports.retangle = retangle
exports.untangle = untangle
exports.stringify = stringify
exports.parse = parse

function untangle(obj){
  var repeats = []
  var t = traverse(obj,{ branch: branch, pre: true })
    
  return t

  function branch (p){

    if(p.referenced && -1 == repeats.indexOf(p.value)){
      repeats.push(p.value)
      return  { '*@': p.index.repeated
       