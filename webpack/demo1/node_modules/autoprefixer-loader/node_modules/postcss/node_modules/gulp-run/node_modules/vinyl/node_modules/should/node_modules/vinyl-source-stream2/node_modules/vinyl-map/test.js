var concat = require('concat-stream')
var test = require('tape')
var File = require('vinyl')
var map = require('./')
var fs = require('fs')

test('null streams are just passed on', function(t) {
  var file = new File({
    contents: null
  })

  var stream = map(function(string) {
    t.fail('should not get called')
  })

  stream.once('end', function() {
    t.end()
  }).end(file)
})

test('buffer streams are passed a buffer', function(t) {
  var contents = fs.readFileSync(__filename)
  var file = new File({
    contents: contents
  })

  var stream = map(function(src) {
    t.ok(Buffer.isBuffer(src), 'Buffer.isBuffer(contents)')
    t.equal(String(contents), String(src), 'Buffer contents are correct')
  })

  stream.once('end', function() {
    t.end()
  }).end(file)
})

test('modifying buffer streams', function(t) {
  t.plan(5)

  var contents = fs.readFileSync(__filename)
  var file = new File({
    contents: contents
  })

  var stream = map(function(src) {
    t.ok(Buffer.isBuffer(src), 'Buffer.isBuffer