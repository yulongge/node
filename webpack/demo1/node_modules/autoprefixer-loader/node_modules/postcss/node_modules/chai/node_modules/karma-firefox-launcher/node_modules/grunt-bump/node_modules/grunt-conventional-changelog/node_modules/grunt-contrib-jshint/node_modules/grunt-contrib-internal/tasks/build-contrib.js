/*
 * grunt-contrib-internal
 * http://gruntjs.com/
 *
 * Copyright (c) 2014 Tyler Kellen, contributors
 * Licensed under the MIT license.
 */

'use strict';

module.exports = function(grunt) {

  // Add custom template delimiters.
  grunt.template.addDelimiters('build-contrib', '{%', '%}');

  grunt.registerTask('build-contrib', 'Generate contrib plugin files.', function() {
    var path = require('path');
    var readJson = require('read-package-json');

    var done = this.async();
    var asset = path.join.bind(null, __dirname, 'assets');
    var self = this;

    readJson('package.json', console.error, false, function (err, data) {
      if (err) {
        console.error("There was an error reading the file");
        done(false);
      }

      var meta = data;
      meta.changelog = grunt.file.readYAML('CHANGELOG');
      meta.travis = grunt.file.exists('.travis.yml');

      if (meta.travis) {
        // create a valid Travis URL, based on [user/repository_name]
        meta.travis = 'https://travis-ci